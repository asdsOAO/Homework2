# 資料結構 題目三

## 41243239 陳裕翔

(a) 外部排序第二階段的總輸入時間
外部排序的第二階段是「歸併階段」，目標是將磁盤上的 m 個已排序的運行段（runs）最終歸併成一個完整的排序文件。在此過程中，數據需要不斷地從磁盤讀入內存進行處理。

我們來一步步推導總輸入時間 t 
input
​
  的計算公式：

歸併遍數 (P)：
由於我們採用 k 路歸併，即每次將 k 個運行段歸併成一個，所以從 m 個運行段歸併成一個運行段所需的總遍數為：
P=⌈log 
k
​
 m⌉。

緩衝區分配 (B)：
為了實現輸入、輸出和 CPU 處理的重疊（如 Program 7.21 所示，通常意味著雙緩衝），我們需要為每個輸入流和輸出流分配兩個緩衝區。對於 k 路歸併，有 k 個輸入流和 1 個輸出流，所以總共需要 2k 個輸入緩衝區和 2 個輸出緩衝區，即 2(k+1) 個緩衝區。
若將總內存容量 S 平均分配給這些緩衝區，則每個緩衝區（即每次磁盤讀寫的塊大小）可容納的記錄數為：
B= 
2(k+1)
S
​
  條記錄。

總磁盤讀取記錄數：
在每個歸併遍數中，所有 n 條記錄都需要從磁盤讀入。因此，在 P 個歸併遍數中，總共需要從磁盤讀取的記錄數為 n⋅P。

總磁盤讀取操作次數：
每次磁盤讀取都會讀取一個 B 大小的塊。所以，總的讀取操作次數為：
讀取次數= 
每塊記錄數
總讀取記錄數
​
 = 
B
n⋅P
​
 = 
S/(2(k+1))
n⋅P
​
 = 
S
2n⋅P⋅(k+1)
​
 。

單次磁盤讀取操作時間：
每次磁盤讀取操作由三部分組成：尋道時間 (t 
s
​
 )、等待時間 (t 
l
​
 ) 和數據傳輸時間 (B⋅t 
t
​
 )。
單次讀取時間=t 
s
​
 +t 
l
​
 +B⋅t 
t
​
 =t 
s
​
 +t 
l
​
 + 
2(k+1)
S
​
 ⋅t 
t
​
 。

總輸入時間 (t 
input
​
 )：
總輸入時間是總讀取操作次數乘以單次讀取操作時間：
t 
input
​
 =( 
S
2n⋅P⋅(k+1)
​
 )⋅(t 
s
​
 +t 
l
​
 + 
2(k+1)
S
​
 ⋅t 
t
​
 )
展開此式，我們得到：
t 
input
​
 = 
S
2n⋅P⋅(k+1)
​
 (t 
s
​
 +t 
l
​
 )+ 
S
2n⋅P⋅(k+1)
​
 ⋅ 
2(k+1)
S
​
 ⋅t 
t
​
 
簡化後，最終公式為：
t 
input
​
 = 
S
2n⋅P⋅(k+1)
​
 (t 
s
​
 +t 
l
​
 )+n⋅P⋅t 
t
​
 

(b) t 
input
​
  對 k 的大致曲線圖及 t 
CPU
​
 <t 
input
​
  的判斷
現在，我們將題目提供的數值代入上述公式，並分析其行為。

t 
s
​
 =80ms=0.08 s
t 
l
​
 =20ms=0.02 s
n=200000 條記錄
m=64 個運行段
t 
t
​
 =10 
−3
  s/record=0.001 s/record
S=2000 條記錄
將這些數值代入簡化後的 t 
input
​
  公式：
t 
input
​
 = 
2000
2⋅200000⋅P⋅(k+1)
​
 (0.08+0.02)+200000⋅P⋅(0.001)
t 
input
​
 = 
2000
400000⋅P⋅(k+1)
​
 (0.1)+200⋅P
t 
input
​
 =200⋅P⋅(k+1)⋅0.1+200⋅P
t 
input
​
 =20⋅P⋅(k+1)+200⋅P
t 
input
​
 =P⋅(20k+20+200)
t 
input
​
 =P⋅(20k+220)

其中，P=⌈log 
k
​
 64⌉。k 的有效範圍是從 2 到 S−1=1999。

我們來計算幾個關鍵 k 值下的 t 
input
​
 ：

| k | P=⌈log 
k
​
 64⌉ | t 
input
​
 =P⋅(20k+220) (秒) |
| :-- | :---------------------------- | :---------------------------------------- |
| 2   | 6                             | 6⋅(20⋅2+220)=1560       |
| 3   | 4                             | 4⋅(20⋅3+220)=1120       |
| 4   | 3                             | 3⋅(20⋅4+220)=900        |
| 8   | 2                             | 2⋅(20⋅8+220)=760        |
| 64  | 1                             | 1⋅(20⋅64+220)=1500      |
| 1999| 1                             | 1⋅(20⋅1999+220)=40200   |

t 
input
​
  對 k 的大致曲線圖
t 
input
​
  對 k 的曲線圖會呈現出階梯狀的特徵。

這是因為歸併遍數 P=⌈log 
k
​
 64⌉ 是一個階梯函數，它會隨著 k 的增加而間歇性地跳變（例如從 6 變到 4，再變到 3，然後變到 2，最後變到 1）。
在每個 P 值保持不變的區間內，t 
input
​
 =P⋅(20k+220) 是一個關於 k 的線性遞增函數。這表示在這些區間內，隨著 k 增大，所需的總輸入時間也會線性增加。
整體而言，曲線會先因 P 的下降而呈現總體下降趨勢，直到 P 達到其最小值（即 P=1）。從我們的計算中可以看出，t 
input
​
  的最低點發生在 k=8 時，其值為 760 s。
一旦 P 穩定在 1 (當 k≥64 時)，t 
input
​
  將持續隨 k 線性增長。例如，當 k=1999 時，t 
input
​
  達到最大值 40200 s。
t 
CPU
​
 <t 
input
​
  是否總成立？
答案是：不，並不總是存在一個 k 值使得 t 
CPU
​
 <t 
input
​
 。

原因如下：

我們知道 t 
CPU
​
  是一個常數。
而 t 
input
​
  是一個變化的值，它有一個明確的最小值（760 s，發生在 k=8 時）和一個在 k 的有效範圍內的最大值（40200 s，發生在 k=1999 時）。
如果 t 
CPU
​
  是一個非常大的常數，例如 t 
CPU
​
 =50000 s，那麼它將大於所有可能的 t 
input
​
  值（因為 t 
input
​
  的最大值是 40200 s）。在這種情況下，無論 k 取何值，t 
CPU
​
 <t 
input
​
  都不可能成立。
相反，如果 t 
CPU
​
  是一個非常小的常數，例如 t 
CPU
​
 =100 s，那麼它將小於所有可能的 t 
input
​
  值（因為 t 
input
​
  的最小值是 760 s）。在這種情況下，對於所有有效的 k 值，t 
CPU
​
 <t 
input
​
  都會成立。
因此，判斷 t 
CPU
​
 <t 
input
​
  是否成立，取決於常數 t 
CPU
​
  的具體數值落在 t 
input
​
  值域（760 s 到 40200 s）的哪個位置。這並不是一個普遍成立的條件。
